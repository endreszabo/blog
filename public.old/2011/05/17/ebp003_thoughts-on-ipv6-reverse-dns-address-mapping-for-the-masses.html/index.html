<!doctype html><title>Thoughts on IPv6 Reverse DNS Address Mapping for the masses :: end.re</title><link href rel=alternate type=application/rss+xml title=end.re><link rel="shortcut icon" href=/favicon.png><link href=/a/s.css media=screen rel=stylesheet><link href=/css/h.css rel=stylesheet><script>const enable_comments=function(){document.getElementById("button_enable_comments").style.display='none';var disqus_config=function(){this.page.url="https://end.re/ebp003/";this.page.identifier="ebp003";};var d=document,s=d.createElement('script');s.src='https://endreszabo.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);}</script><link href=http://gmpg.org/xfn/11 rel=profile><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png href=/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicon-16x16.png sizes=16x16><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=theme-color content=#fafafa><meta property=og:title content="Thoughts on IPv6 Reverse DNS Address Mapping for the masses"><meta property=og:description content="yet another tech blog with underdeveloped thoughts, quick and dirty tips and tricks, random ramblings"><meta property=og:type content=website><meta property=og:locale content=en_US><meta property=og:url content=https://end.re/2011/05/17/ebp003_thoughts-on-ipv6-reverse-dns-address-mapping-for-the-masses.html/><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="yet another tech blog with underdeveloped thoughts, quick and dirty tips and tricks, random ramblings"><meta name=keywords content=dns><meta name=author content="Endre Szabo"><meta name=generator content="Hugo 0.40.2"><header class=header-main><div class=logo><a title=end.re href=https://end.re><img src=/images/el.svg alt=logo width=90 class=logo-main></a></div><div class=nav><nav class=main-nav><ul><li><a href=/blog/>Blog</a><li><a href=/tutorial/>Tutorials</a><li><a href=/about/>About</a></ul></nav></div></header><main class=wrapper-main><section class=wrapper-content><section class=post-index itemscope itemtype=http://schema.org/BlogPosting><article class=post-content><div class=post-header><h2 class=post-title itemprop=name>Thoughts on IPv6 Reverse DNS Address Mapping for the masses</h2><span class=a-meta><a class=category-half-baked-ideas href=/categories/half-baked-ideas/>Half Baked Ideas</a></span>
<span class=m-split><a class=tag-dns href=/tags/dns/>#dns</a></span>
<time class=m-split datetime=2011-05-17T18:29:00&#43;00:00>May 17th, 2011</time></div><div class="entry-content full-article" itemprop=articleBody><p>Reverse DNS records are good for you. Especially if you run your own SMTP MTAs. Without proper reverse-forward DNS record mapping, some nice anomalies may appear for you. You may have faced the fact some other MTAs shut down your incoming connection for no particular reason. OpenSSH daemon also has the option to check if your forward and reverse DNS entries match. Also, being on IRC with only an IP address is so 90&rsquo;s ;)<p><p>In the IPv4 times we had relatively small subnets where we could easily set up reverse reocrds for our hosts. However, with IPv6 we now have plenty addresses available so dealing manually with the records is not the way to go.<p>A Hungarian telco, Magyar Telecom, provides IPv6 access pilot for home users via ADSL PPPoE, delegating them /56 subnets upon request. Many tunnel brokers let you use your own nameservers for reverse PTR records for the delegated subnets. This is not the case with Telekom, they serve the reverse records for each and every IP address that belong to the delegated subnets. They have chosen the representation of non-compressed ipv6 addresses without the colon separator (20014C48010002D3D80C3CA1F161E842.access.pool.telekom.hu). DIGI, another company in Hungary service area is providing IPv6 access that has dynamic v6 reverse servers for their customers. DIGI has became a SixXS PoP with two nodes and also has an IPv6 pilot for customers in a chosen city. DIGI does this using two other nameservers than their main ones serving regular PTR records: ns1-dynv6.hdsnet.hu and ns2-dynv6.hdsnet.hu respectively. They represent IP addresses as they are in regular non-compressed convention but with changing colons to minus signs (2a01-0368-e002-0000-0000-0000-0000-0001.pool6.digikabel.hu). The actual solution Magyar Telekom and DIGI uses is unknown to me.<p>Serving this large zones obviously cannot be done with classic in-memory static zone files as it would need much, very MUCH of storage capacity just to store the records for the 2^72 address delegated for one single subscriber&rsquo;s connection.<h2 id=solutions-in-the-wild>Solutions in the wild</h2><p>There are a few simple yet powerful services for this issue, one of them is ip6arpa.co.cc. It only needs your reverse zones delegated to its nameserver, everything else done magically. Of course this prevents you to have custom rDNS record for your hosts. Another one is made by DJB: walldns that simply maps the IP address to the appropiate in-addr.arpa entries pretty much the same way as ip6arpa.co.cc does.<p>I also met this technique when I was at the 27th Chaos Communication Congress (27c3) in 2010, where the network guys set up a DNS server providing dynamic reverse (and forward) records for both the IPv4 (/16) and IPv6 (/48) subnets delegated for the congress itself. They made nice mappings looking on IRC like the following:<pre><code>muckl [~hans@node-d635ikmq0jzy23f.ipv6.congress.ccc.de] has joined #27c3
nikNULLP0INTER [~okin@node-37k.ipv4.congress.ccc.de] has joined #27c3
</code></pre><p>Base 36 encoding of IP address is the most compact way an IP address can be represented in compliance with the according RFCs (though an <a href=https://tools.ietf.org/html/rfc1924 target=_blank>april&rsquo;s fool RFC</a> is out for base 85 representation). This was more than perfect for my SOHO needs. I just needed the exact solution the guys at 27c3 were using. The authoritive name server DNS version query showed that PowerDNS was being used for this purpose.<p>I have heard of PowerDNS being powerful, just not thought that it is this much powerful.<p>So with all these informations I began to look around for ready made solutions. The first relevant match was v6rev which just does an eye-friendly reverse representation of ip addresses but not in such a compact way. Later I found a pipe backend written in C for PowerDNS which had the same limitation as v6rev had: it still need its own subdomain for the delegated zone. I find it technically awesome to have the reverse records mapped automatically right in the topmost domain.<h2 id=my-approach>My approach</h2><p>There were no ready to use tools having these features so I started to write my own in Perl. A prototype version worked well but it did a lot on-the-fly math with the IP addreses. Meanwhile I have found the original code that was used at 27c3 and I immediately started to enchance it to fit my needs as it also had support for IPv4 addresses with the same library they were using for IPv6. I have added the following features to the original code:<ul><li>custom prefix and postfix settings per subnet,<li>best match of prefixes using radix trie,<li>attribute inheritance within prefix tree (dict inheriting class included),<li>automatic reverse zone calculation.</ul><p>It accepts the following configuration parameters stored in a dictionary:<div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=n>DEFAULTS</span> <span class=o>=</span> <span class=p>{</span>
    <span class=s1>&#39;email&#39;</span><span class=p>:</span> <span class=s1>&#39;hostmaster.example.com&#39;</span><span class=p>,</span>
    <span class=s1>&#39;dns&#39;</span><span class=p>:</span> <span class=s1>&#39;ns0.example.com&#39;</span><span class=p>,</span>
    <span class=s1>&#39;ttl&#39;</span><span class=p>:</span> <span class=mi>300</span><span class=p>,</span>
    <span class=s1>&#39;version&#39;</span><span class=p>:</span> <span class=mi>6</span><span class=p>,</span>
    <span class=s1>&#39;nameserver&#39;</span><span class=p>:</span> <span class=p>[</span>
        <span class=s1>&#39;ns0.example.com&#39;</span><span class=p>,</span>
        <span class=s1>&#39;ns1.example.com&#39;</span>
    <span class=p>]</span>
<span class=p>}</span></code></pre></div><p>Default are for the SOA record as well for the NS records needed to reflect the zone delegation records defined at the tunnelbroker side. Prefix delegation mapping are defined like the following (all defined values are overriding the default ones):<div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=n>PREFIXES</span> <span class=o>=</span> <span class=p>{</span>
    <span class=n>netaddr</span><span class=o>.</span><span class=n>IPNetwork</span><span class=p>(</span><span class=s1>&#39;2a01:270:201b::/48&#39;</span><span class=p>):</span>    <span class=n>HierDict</span><span class=p>(</span><span class=n>DEFAULTS</span><span class=p>,{</span><span class=s1>&#39;prefix&#39;</span><span class=p>:</span> <span class=s1>&#39;u&#39;</span><span class=p>,</span> <span class=s1>&#39;postfix&#39;</span><span class=p>:</span> <span class=s1>&#39;-node0&#39;</span><span class=p>,</span> <span class=s1>&#39;forward&#39;</span><span class=p>:</span> <span class=s1>&#39;y7.hu&#39;</span><span class=p>,}),</span>
    <span class=n>netaddr</span><span class=o>.</span><span class=n>IPNetwork</span><span class=p>(</span><span class=s1>&#39;2a01:270:201b:1::/64&#39;</span><span class=p>):</span>  <span class=n>HierDict</span><span class=p>(</span><span class=n>DEFAULTS</span><span class=p>,{</span><span class=s1>&#39;prefix&#39;</span><span class=p>:</span> <span class=s1>&#39;h&#39;</span><span class=p>,</span> <span class=s1>&#39;postfix&#39;</span><span class=p>:</span> <span class=s1>&#39;-vpn0-node0&#39;</span><span class=p>,</span> <span class=s1>&#39;forward&#39;</span><span class=p>:</span> <span class=s1>&#39;y7.hu&#39;</span><span class=p>,})</span>
<span class=p>}</span></code></pre></div><p>Example operation:<pre><code># dig -x 2a01:270:90bd::1 +short
u1-node0.y7.hu.
# dig -x 2a01:270:90bd:1::1 +short
h1-vpn0-node0.y7.hu.
# dig -x 2a01:270:90bd::dead:c0de +short
u1ps9xb2-node0.y7.hu.
#
# dig -t aaaa h1-vpn0-node0.y7.hu. +short
2a01:270:90bd:1::1
# dig -t aaaa usomefoobar-node0.y7.hu. +short
2a01:270:90bd:0:a:597c:761c:6333
# dig -t aaaa hsomefoobar-vpn0-node0.y7.hu. +short
2a01:270:90bd:1:a:597c:761c:6333
</code></pre><p>Automatically generated record can be overridden depending of the order of the launch of backends specified in the PowerDNS configuration. The forked source can be found in my github repo.</div></article></section><hr><section id=comments><h2 class=title>Your opinion mattersâ€”be heard</h2><button id=button_enable_comments class=comments-toggle onclick=enable_comments();>Click to show comments</button><div id=disqus_thread aria-live=polite><noscript><p>I respect your privacy. In general JavaScript is not required at all to view this site properly. However, if you are interested in comments please enable running of JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by my outsourced comment section provider Disqus.</a></p></noscript></div></section></section></section><footer id=footer class=inner><a rel=license href=http://creativecommons.org/licenses/by-sa/4.0/><img alt="Creative Commons License" style=border-width:0 src=/images/cc-by-sa-4-0.png></a><br>Website contents at end.re by Endre Szabo are licensed under the <a rel=license href=http://creativecommons.org/licenses/by-sa/4.0/>Creative Commons Attribution-ShareAlike 4.0 International License</a> unless stated otherwise.</footer><script src=/js/highlight.js></script><script>hljs.initHighlightingOnLoad();</script></main>